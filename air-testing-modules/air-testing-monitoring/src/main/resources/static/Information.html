<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
    <!-- 引入 echarts.js -->
    <script src="js/echarts.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <title> 信息管理界面</title>
    <style>

    </style>
    <script type="text/javascript">
        $(function(){
            //调用加载数据函数
            loadstu();
            //查询接口


            //为添加按钮绑定一个添加动作
            $("#aid").click(function(){
                $("#fill").show();
                $("#myform").show();
            });
        });

        //加载学生信息
        function loadstu(){
            $.ajax({
                type:"GET",
                url:"/device/getAllLatestDevice",
                dataType:"json",
                success:function(result){
                    //alert(data);
                    var str=null;
                    for(var i=0;i<result.data.length;i++){
                        str+="<tr>";
                        str+="<td>"+(i+1)+"</td>";
                        str+="<td>"+result.data[i].deviceCode+"</td>";
                        str+="<td>"+result.data[i].deviceDesc+"</td>";
                        str+="<td>"+result.data[i].address+"</td>";
                        str+="<td>"+result.data[i].longitude+"</td>";
                        str+="<td>"+result.data[i].latitude+"</td>";
                        str+="<td>"+result.data[i].sim+"</td>";
                        str+="<td>"+result.data[i].protocol+"</td>";
                        str+="<td>"+result.data[i].collectInterval+"</td>";
                        str+="<td>"+result.data[i].createtime+"</td>";
                        str+="<td>"+result.data[i].updatetime+"</td>";
                        str+="<td><a href=\"javascript:void(0);\" onclick='doDel("+result.data[i].id+")'>删除</a></td>";
                        str+="</tr>";

                    }
                    $("#stuid tbody").empty();
                    $("#stuid tbody").append(str);
                }
            });
        }

        //删除函数
        function doDel(id){
            //执行ajax删除
            if(confirm("确定要删除吗？")){
                $.ajax({
                    url:"/device/deleteOneDevice/"+id,
                    type:"POST",
                    data:{id:id},
                    dataType:"json",
                    success:function(json){
                        //判断是否删除成功
                        if(json.result=="true") {
                            //alert(res.num);
                            $(id).parents("tr").remove();
                        }
                    },
                    error:function(){
                        alert('error');
                    }
                });}

        }

        //执行添加
        function doAdd(form) {
            var showType01 = document.getElementById("field1").value;
            var showType02 = document.getElementById("field2").value;
            var showType03 = document.getElementById("field3").value;
            var showType04 = document.getElementById("field4").value;
            var showType05 = document.getElementById("field5").value;
            var showType06 = document.getElementById("field6").value;
            var showType07 = document.getElementById("field7").value;
            var showType08 = document.getElementById("field8").value;
            $.ajax({
                type: "post",
                url: "/device/insertDevice",
                async: false,
                dataType: 'json',
                data: {
                    deviceCode: showType01,
                    deviceDesc: showType02,
                    address: showType03,
                    longitude: showType04,
                    latitude: showType05,
                    sim: showType06,
                    protocol: showType07,
                    collectInterval: showType08
                },
                beforeSend: function () {
                    $("#span_content").text("数据处理中...");
                },
                success:function(json){
                    //判断是否删除成功
                    if(json.result.data.id > 0) {

                        location.reload();
                    }
                },
                error:function () {
                    location.reload();
                }

            })
            loadstu();
        }

    </script>
</head>
<body><h2><font color="black">设备信息管理</font></h2>
<button id="aid">添加</button>
<table id="stuid"  class="table table-hover table-bordered" >
    <thead>
    <tr>
        <th>ID</th><th>DeviceCode</th><th>DeviceDesc</th><th>Address</th><th>Longitude</th><th>Latidute</th><th>SIM</th><th>Protocol</th><th>Collect_Interval</th><th>Createtime</th><th>Updatetime</th>
        <th>操作</th>
    </tr>
    </thead>
    <tbody>

    </tbody>
</table>


<div id="fill" style="width:100%;height:100%;background-color:#000;position:absolute;top:0px;left:0px;opacity:0.3;display:none;z-index:100">
</div>

<div id="myform" style="width:100%;height:100%;position:absolute;top:0px;left:0px;z-index:101;display:none">
    <form  action="" method="post" onsubmit="return doAdd(this)">
        <table width="340" border="0" style="margin:20% auto;background-color:#fff">
            <tr>
                <td>DeviceCode：</td>
                <td><input type="text" id="field1" value=""></td>
            </tr>
            <tr>
                <td>DeviceDesc：</td>
                <td><input type="text" id="field2" value=""></td>
            </tr>
            <tr>
                <td>Address：</td>
                <td><input type="text" id="field3" value=""></td>
            </tr>
            <tr>
                <td>Longitude：</td>
                <td><input type="text" id="field4" value=""></td>
            </tr>
            <tr>
                <td>Latidute：</td>
                <td><input type="text" id="field5" value=""></td>
            </tr>
            <tr>
                <td>SIM：</td>
                <td><input type="text" id="field6" value=""></td>
            </tr>
            <tr>
                <td>Protocol：</td>
                <td><input type="text" id="field7" value=""></td>
            </tr>
            <tr>
                <td>Collect_Interval：</td>
                <td><input type="text" id="field8" value=""></td>
            </tr>
            <tr>
                <td> </td>
                <td >
                    <input type='submit' value="添加"/>
                    <!--<input type='reset' value="重置"/>-->
                    <input type="button" onclick="$('#fill').hide();$('#myform').hide();" value="关闭"/>
                </td>
            </tr>
        </table>
    </form>
</div>


</body>
</html>